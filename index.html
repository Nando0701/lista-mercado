<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lista de Mercado</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 10px;
    }

    .header {
      display: flex;
      align-items: center;
      background-color: #3f6fda;
      color: white;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    #filter {
      flex-grow: 1;
      font-size: 16px;
      padding: 6px;
      border-radius: 6px;
    }

    .item {
      display: flex;
      align-items: center;
      background-color: white;
      margin-bottom: 6px;
      padding: 8px;
      border-radius: 8px;
    }

    .cart-icon {
      font-size: 20px;
      margin-right: 10px;
      cursor: pointer;
    }

    .item-name {
      flex-grow: 1;
      font-size: 16px;
    }

    .delete-btn {
      font-size: 18px;
      color: #d00;
      cursor: pointer;
      margin-left: 10px;
    }

    .footer {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      gap: 10px;
    }

    button {
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
    }

    #add-button {
      background-color: #3f6fda;
      flex-grow: 2;
    }

    #save-button,
    #load-button {
      background-color: #3f6fda;
      flex-grow: 1;
    }
  </style>
</head>

<body>
  <div class="header">
    <select id="filter">
      <option value="comprar">Mostrando Itens a Comprar</option>
      <option value="todos">Mostrando Todos os Itens</option>
      <option value="nao">Mostrando Itens N√£o Selecionados</option>
    </select>
  </div>

  <div id="item-list"></div>

  <div class="footer">
    <button id="add-button">Adicionar item</button>
    <button id="save-button">SALVAR LISTA</button>
    <button id="load-button">ABRIR LISTA</button>
  </div>

  <script>
    let items = JSON.parse(localStorage.getItem("listaMercado") || "[]");

    const itemList = document.getElementById("item-list");
    const filter = document.getElementById("filter");
    const addButton = document.getElementById("add-button");
    const saveButton = document.getElementById("save-button");
    const loadButton = document.getElementById("load-button");

    function renderList() {
      itemList.innerHTML = "";
      const filtro = filter.value;

      items.forEach((item, index) => {
        const show =
          filtro === "todos" ||
          (filtro === "comprar" && item.status === "comprar") ||
          (filtro === "nao" && item.status === "nenhum");
        if (!show) return;

        const div = document.createElement("div");
        div.className = "item";

        const carrinho = document.createElement("span");
        carrinho.className = "cart-icon";
        carrinho.innerHTML = "üõí";
        carrinho.style.color =
          item.status === "comprar"
            ? "red"
            : item.status === "comprado"
            ? "green"
            : "blue";

        carrinho.onclick = () => {
          if (item.status === "nenhum") item.status = "comprar";
          else if (item.status === "comprar") item.status = "comprado";
          else item.status = "nenhum";
          localStorage.setItem("listaMercado", JSON.stringify(items));
          renderList();
        };

        const span = document.createElement("span");
        span.className = "item-name";
        span.textContent = item.nome;

        const remover = document.createElement("span");
        remover.className = "delete-btn";
        remover.textContent = "üóëÔ∏è";
        remover.onclick = () => {
          if (confirm("Deseja remover este item da lista?")) {
            items.splice(index, 1);
            localStorage.setItem("listaMercado", JSON.stringify(items));
            renderList();
          }
        };

        div.appendChild(carrinho);
        div.appendChild(span);
        div.appendChild(remover);
        itemList.appendChild(div);
      });
    }

    addButton.onclick = () => {
      const nome = prompt("Digite o nome do novo item:");
      if (nome && nome.trim()) {
        items.push({ nome: nome.trim(), status: "nenhum" });
        localStorage.setItem("listaMercado", JSON.stringify(items));
        renderList();
      }
    };

    saveButton.onclick = () => {
      const blob = new Blob([JSON.stringify(items, null, 2)], {
        type: "application/json",
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "lista-mercado.json";
      a.click();
    };

    loadButton.onclick = () => {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.onchange = (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            items = JSON.parse(e.target.result);
            localStorage.setItem("listaMercado", JSON.stringify(items));
            renderList();
          } catch {
            alert("Arquivo inv√°lido.");
          }
        };
        reader.readAsText(file);
      };
      input.click();
    };

    filter.onchange = renderList;
    renderList();
  </script>
</body>

</html>

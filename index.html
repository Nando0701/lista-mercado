<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Mercado</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 10px;
      background: #f7f7f7;
    }

    .input-section {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    #new-item {
      flex-grow: 1;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    #add-button {
      width: 40px;
      height: 40px;
      background-color: #4CAF50;
      color: white;
      font-size: 24px;
      border: none;
      border-radius: 50%;
    }

    #filter-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    #filter {
      padding: 6px;
      font-size: 14px;
    }

    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      margin-bottom: 5px;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 15px;
    }

    .item span {
      flex-grow: 1;
    }

    .remove {
      color: red;
      margin-left: 10px;
      cursor: pointer;
    }

    .cart-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      color: white;
      margin-right: 10px;
    }

    .blue {
      background-color: #2196F3;
    }

    .red {
      background-color: #F44336;
    }

    .green {
      background-color: #4CAF50;
    }

    #backup-notice {
      display: none;
      margin-top: 10px;
      padding: 10px;
      background: #fff3cd;
      border: 1px solid #ffeeba;
      border-radius: 6px;
    }

    #backup-notice button {
      margin-left: 10px;
    }

    #save-button {
      margin-top: 10px;
      padding: 6px 12px;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="input-section">
    <input type="text" id="new-item" placeholder="Adicionar novo item">
    <button id="add-button">+</button>
  </div>

  <div id="filter-controls">
    <select id="filter">
      <option value="todos">MOSTRANDO TODOS OS ITENS</option>
      <option value="comprar">MOSTRANDO ITENS A COMPRAR</option>
      <option value="nao">MOSTRANDO ITENS N√ÉO SELECIONADOS</option>
    </select>
  </div>

  <div id="item-list"></div>

  <div id="backup-notice">
    Voc√™ fez v√°rias altera√ß√µes na lista. Deseja salvar um backup?
    <button id="save-now">Salvar agora</button>
    <button id="dismiss">Dispensar</button>
  </div>

  <button id="save-button">Salvar lista</button>

  <script>
    let items = JSON.parse(localStorage.getItem('listaMercado') || '[]');
    let alteracoes = 0;

    const itemList = document.getElementById('item-list');
    const newItemInput = document.getElementById('new-item');
    const addButton = document.getElementById('add-button');
    const filter = document.getElementById('filter');
    const saveButton = document.getElementById('save-button');
    const backupNotice = document.getElementById('backup-notice');
    const saveNow = document.getElementById('save-now');
    const dismissBtn = document.getElementById('dismiss');

    function renderList() {
      itemList.innerHTML = '';
      const filtro = filter.value;
      items.forEach((item, index) => {
        const mostrar =
          filtro === 'todos' ||
          (filtro === 'comprar' && item.status === 'comprar') ||
          (filtro === 'nao' && item.status !== 'comprar');

        if (!mostrar) return;

        const div = document.createElement('div');
        div.className = 'item';

        const carrinho = document.createElement('div');
        carrinho.className = 'cart-btn';
        if (item.status === 'comprar') carrinho.classList.add('red');
        else if (item.status === 'comprado') carrinho.classList.add('green');
        else carrinho.classList.add('blue');
        carrinho.textContent = 'üõí';

        carrinho.onclick = () => {
          if (item.status === 'nenhum') item.status = 'comprar';
          else if (item.status === 'comprar') item.status = 'comprado';
          else item.status = 'nenhum';
          localStorage.setItem('listaMercado', JSON.stringify(items));
          renderList();
        };

        const span = document.createElement('span');
        span.textContent = item.nome;

        const remove = document.createElement('span');
        remove.className = 'remove';
        remove.textContent = 'üóëÔ∏è';
        remove.onclick = () => {
          if (confirm('Deseja realmente remover este item da lista base?')) {
            items.splice(index, 1);
            alteracoes++;
            verificarBackup();
            localStorage.setItem('listaMercado', JSON.stringify(items));
            renderList();
          }
        };

        div.appendChild(carrinho);
        div.appendChild(span);
        div.appendChild(remove);
        itemList.appendChild(div);
      });
    }

    function adicionarItem() {
      const nome = newItemInput.value.trim();
      if (nome) {
        items.push({ nome, status: 'nenhum' });
        alteracoes++;
        verificarBackup();
        localStorage.setItem('listaMercado', JSON.stringify(items));
        newItemInput.value = '';
        renderList();
      }
    }

    function verificarBackup() {
      if (alteracoes >= 10) {
        backupNotice.style.display = 'block';
      }
    }

    addButton.onclick = adicionarItem;
    newItemInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') adicionarItem();
    });

    filter.value = 'todos'; // padr√£o ao carregar
    filter.onchange = renderList;

    saveButton.onclick = () => {
      const blob = new Blob([JSON.stringify(items, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'lista-mercado.json';
      a.target = '_blank';
      a.click();
    };

    saveNow.onclick = () => {
      alteracoes = 0;
      backupNotice.style.display = 'none';
      saveButton.click();
    };

    dismissBtn.onclick = () => {
      alteracoes = 0;
      backupNotice.style.display = 'none';
    };

    renderList();
  </script>
</body>

</html>

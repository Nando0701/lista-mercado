<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lista de Compras</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 10px;
      background-color: #f0f0f0;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #3b6dc5;
      color: white;
      padding: 10px;
      border-radius: 8px;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .top-bar select {
      padding: 4px;
      border-radius: 4px;
      font-size: 14px;
    }

    .item {
      display: flex;
      align-items: center;
      background: white;
      border-radius: 6px;
      margin-bottom: 6px;
      padding: 6px;
      border: 1px solid #ccc;
    }

    .item input {
      flex: 1;
      border: none;
      font-size: 16px;
      margin: 0 6px;
      background: transparent;
    }

    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
    }

    .cart {
      color: #888;
    }

    .cart.comprar {
      color: red;
    }

    .cart.ok {
      color: green;
    }

    .footer-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      gap: 10px;
    }

    .footer-buttons button {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      background-color: #3b6dc5;
      color: white;
      border: none;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <span id="filter-label">Mostrando Itens a Comprar</span>
    <select id="filter-select">
      <option value="comprar">Itens a Comprar</option>
      <option value="todos">Todos os Itens</option>
      <option value="nao">Itens Não Selecionados</option>
    </select>
  </div>

  <div id="lista"></div>

  <div class="footer-buttons">
    <button onclick="adicionarItem()">Adicionar item</button>
    <button onclick="salvarLista()">SALVAR LISTA</button>
    <button onclick="abrirLista()">ABRIR LISTA</button>
  </div>

  <script>
    let lista = JSON.parse(localStorage.getItem('listaMercado') || '[]');
    const listaEl = document.getElementById('lista');
    const filtroEl = document.getElementById('filter-select');
    const labelFiltro = document.getElementById('filter-label');

    function renderizar() {
      listaEl.innerHTML = '';
      const filtro = filtroEl.value;

      lista.forEach((item, i) => {
        const mostrar = 
          filtro === 'todos' ||
          (filtro === 'comprar' && item.status === 'comprar') ||
          (filtro === 'nao' && item.status === 'neutro');

        if (!mostrar) return;

        const div = document.createElement('div');
        div.className = 'item';

        const btnCarrinho = document.createElement('button');
        btnCarrinho.className = `icon-btn cart ${item.status}`;
        btnCarrinho.innerHTML = '🛒';
        btnCarrinho.onclick = () => {
          if (item.status === 'neutro') item.status = 'comprar';
          else if (item.status === 'comprar') item.status = 'ok';
          else item.status = 'neutro';
          salvarLocal();
          renderizar();
        };

        const input = document.createElement('input');
        input.value = item.nome;
        input.onchange = (e) => {
          item.nome = e.target.value;
          salvarLocal();
        };

        const btnExcluir = document.createElement('button');
        btnExcluir.className = 'icon-btn';
        btnExcluir.innerHTML = '🗑️';
        btnExcluir.onclick = () => {
          if (confirm('Deseja remover este item?')) {
            lista.splice(i, 1);
            salvarLocal();
            renderizar();
          }
        };

        div.appendChild(btnCarrinho);
        div.appendChild(input);
        div.appendChild(btnExcluir);
        listaEl.appendChild(div);
      });
    }

    function salvarLocal() {
      localStorage.setItem('listaMercado', JSON.stringify(lista));
    }

    function adicionarItem() {
      lista.push({ nome: 'Novo item', status: 'neutro' });
      salvarLocal();
      renderizar();
    }

    function salvarLista() {
      const blob = new Blob([JSON.stringify(lista, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'lista-mercado.json';
      a.click();
    }

    function abrirLista() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            lista = JSON.parse(e.target.result);
            salvarLocal();
            renderizar();
          } catch (err) {
            alert('Erro ao carregar a lista.');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    filtroEl.onchange = () => {
      const labelMap = {
        comprar: 'Mostrando Itens a Comprar',
        todos: 'Mostrando Todos os Itens',
        nao: 'Mostrando Itens Não Selecionados'
      };
      labelFiltro.textContent = labelMap[filtroEl.value];
      renderizar();
    };

    renderizar();
  </script>
</body>
</html>
